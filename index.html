<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mega XO - Platform Gaming</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pocketbase/0.21.3/pocketbase.umd.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            padding: 0.5rem;
            margin: 0;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="80" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="60" r="1" fill="rgba(255,255,255,0.05)"/><circle cx="90" cy="40" r="1.5" fill="rgba(255,255,255,0.08)"/></svg>') repeat;
            pointer-events: none;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            width: min(500px, calc(100vw - 1rem));
            height: min(500px, calc(100vh - 1rem));
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            position: relative;
            z-index: 1;
            overflow: hidden;
            user-select: none;
            max-width: calc(100vw - 1rem);
            max-height: calc(100vh - 1rem);
        }

        .page-container {
            display: flex;
            width: 400%; /* 4 pages */
            height: 100%;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .page {
            width: 25%; /* Each page takes 1/4 of container width */
            height: 100%;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
            min-height: 0;
            box-sizing: border-box;
        }

        /* Page 1 - Welcome */
        .welcome-page {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .welcome-page .logo {
            font-size: clamp(1.8rem, 8vw, 2.5rem);
            font-weight: bold;
            margin-bottom: 1rem;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .welcome-page .tagline {
            font-size: clamp(0.9rem, 4vw, 1.1rem);
            margin-bottom: 1.5rem;
            opacity: 0.9;
        }

        .welcome-page .description {
            font-size: clamp(0.75rem, 3.5vw, 0.85rem);
            line-height: 1.6;
            opacity: 0.8;
            margin-bottom: 2rem;
        }

        /* Page 2 - Info */
        .info-page {
            background: white;
            color: #333;
        }

        .info-page h2 {
            color: #667eea;
            font-size: clamp(1.2rem, 5vw, 1.6rem);
            margin-bottom: 1.5rem;
        }

        .info-page .info-text {
            font-size: clamp(0.75rem, 3.5vw, 0.9rem);
            line-height: 1.6;
            color: #666;
            margin-bottom: 1.5rem;
        }

        .feature-list {
            list-style: none;
            text-align: left;
            width: 100%;
            max-width: 320px;
        }

        .feature-list li {
            display: flex;
            align-items: flex-start;
            margin: 0.8rem 0;
            font-size: 0.8rem;
            color: #555;
            line-height: 1.4;
        }

        .feature-list li span {
            margin-right: 0.8rem;
            font-size: 1rem;
            flex-shrink: 0;
            margin-top: 0.1rem;
        }

        /* Page 3 - Login */
        .login-page {
            background: white;
            color: #333;
        }

        .login-page h2 {
            color: #667eea;
            font-size: clamp(1.1rem, 4.5vw, 1.4rem);
            margin-bottom: 1rem;
        }

        .login-page .login-info {
            font-size: clamp(0.75rem, 3.5vw, 0.85rem);
            color: #666;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        .google-btn {
            background: linear-gradient(135deg, #4285f4 0%, #357ae8 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: clamp(0.8rem, 3.5vw, 0.9rem);
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            max-width: min(280px, calc(100vw - 4rem));
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.1);
            min-height: 50px;
        }

        .google-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2), 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .google-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .google-icon {
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4285f4;
            font-weight: bold;
            font-size: 0.8rem;
        }

        /* Hide login button when authenticated */
        .login-page.authenticated .google-btn {
            display: none;
        }

        .login-page.authenticated .login-info {
            margin-bottom: 2rem;
        }

        .login-success-message {
            display: none;
            color: #28a745;
            font-size: clamp(0.8rem, 3.5vw, 1rem);
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(40, 167, 69, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(40, 167, 69, 0.2);
        }

        .login-page.authenticated .login-success-message {
            display: block;
        }

        /* Page 4 - Home */
        .home-page {
            background: white;
            color: #333;
            padding: 2rem 1.5rem;
        }

        .home-page h2 {
            color: #667eea;
            font-size: 1.3rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .user-info {
            background: rgba(248, 249, 250, 0.8);
            padding: 1rem;
            border-radius: 15px;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(0,0,0,0.05);
            text-align: center;
            width: 100%;
        }

        .user-info img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-bottom: 0.5rem;
            border: 2px solid #667eea;
            object-fit: cover;
        }

        .user-details h3 {
            color: #333;
            margin-bottom: 0.2rem;
            font-size: 1rem;
            word-break: break-word;
        }

        .user-details p {
            color: #666;
            font-size: 0.8rem;
            word-break: break-word;
        }

        .button-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            max-width: 280px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            min-height: 45px;
            width: 100%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2), 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #545b62 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2), 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        /* Navigation */
        .nav-container {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 10;
            flex-wrap: wrap;
            justify-content: center;
            padding: 0 1rem;
            width: calc(100% - 2rem);
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #667eea;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            white-space: nowrap;
            min-height: 36px;
            display: flex;
            align-items: center;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .nav-btn:hover, .nav-btn.active {
            background: rgba(255, 255, 255, 1);
            color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .page-indicators {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 10;
        }

        .indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .indicator.active {
            background: rgba(255, 255, 255, 0.8);
            transform: scale(1.2);
        }

        /* Messages */
        .error, .success {
            padding: 10px 12px;
            border-radius: 8px;
            margin: 10px 0;
            display: none;
            font-size: 0.8rem;
            text-align: center;
            word-break: break-word;
        }

        .error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border-left: 3px solid #dc3545;
        }

        .success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border-left: 3px solid #28a745;
        }

        .loading {
            display: none;
            color: #666;
            margin: 10px 0;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.8rem;
        }

        .loading.show {
            display: flex;
        }

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            backdrop-filter: blur(5px);
            padding: 1rem;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            max-width: 350px;
            width: 100%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .modal h3 {
            margin-bottom: 1rem;
            color: #dc3545;
            font-size: 1.2rem;
        }

        .modal p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .modal-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 1.5rem;
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 768px) {
            body {
                padding: 0.25rem;
            }
            
            .container {
                width: calc(100vw - 0.5rem);
                height: calc(100vh - 0.5rem);
                border-radius: 15px;
                min-height: 400px;
            }
            
            .page {
                padding: 1rem 0.75rem;
            }
            
            .nav-container {
                bottom: 10px;
                gap: 4px;
                padding: 0 0.5rem;
            }
            
            .nav-btn {
                padding: 6px 8px;
                font-size: clamp(0.65rem, 2.8vw, 0.7rem);
                min-height: 32px;
            }
            
            .page-indicators {
                top: 10px;
                right: 10px;
            }
            
            .indicator {
                width: 6px;
                height: 6px;
            }
        }

        @media (max-width: 480px) {
            .page {
                padding: 0.75rem 0.5rem;
            }
            
            .welcome-page .description,
            .info-page .info-text,
            .login-page .login-info {
                margin-bottom: 1rem;
                padding: 0 0.5rem;
            }
            
            .google-btn {
                max-width: calc(100vw - 3rem);
                margin: 0 auto;
            }
            
            .nav-container {
                bottom: 8px;
                gap: 2px;
                padding: 0 0.25rem;
                flex-wrap: wrap;
            }
            
            .nav-btn {
                padding: 4px 6px;
                font-size: clamp(0.6rem, 2.5vw, 0.65rem);
                min-height: 28px;
                flex: 1;
                min-width: 60px;
            }
        }

        @media (max-width: 360px) {
            .container {
                width: calc(100vw - 0.25rem);
                height: calc(100vh - 0.25rem);
                border-radius: 12px;
            }
            
            .page {
                padding: 0.5rem 0.25rem;
            }
            
            .welcome-page .description,
            .info-page .info-text,
            .login-page .login-info {
                padding: 0 0.25rem;
                line-height: 1.4;
            }
        }

        /* Landscape orientation for mobile */
        @media (max-height: 500px) and (orientation: landscape) {
            .container {
                height: calc(100vh - 0.25rem);
            }
            
            .page {
                padding: 0.5rem;
                justify-content: flex-start;
                padding-top: 1rem;
            }
            
            .nav-container {
                bottom: 5px;
            }
            
            .page-indicators {
                top: 5px;
            }
            
            .welcome-page .description,
            .info-page .info-text,
            .login-page .login-info {
                margin-bottom: 0.5rem;
            }
        }

        @media (min-width: 769px) {
            .button-group {
                flex-direction: row;
                justify-content: center;
            }
            
            .modal-buttons {
                flex-direction: row;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Page Indicators -->
        <div class="page-indicators">
            <div class="indicator active"></div>
            <div class="indicator"></div>
            <div class="indicator"></div>
            <div class="indicator"></div>
        </div>

        <!-- Page Container -->
        <div class="page-container" id="pageContainer">
            <!-- Page 1: Welcome -->
            <div class="page welcome-page">
                <div class="logo">MEGA XO</div>
                <div class="tagline">üîê Platform Manajemen Akun</div>
                <div class="description">
                    Selamat datang di Mega XO! Di sini Anda dapat login menggunakan akun Google untuk mengakses dashboard pribadi. Platform ini memberikan Anda kontrol penuh atas akun, termasuk kemampuan untuk menghapus akun Mega XO kapan saja jika diperlukan..
                </div>
            </div>

            <!-- Page 2: Info -->
            <div class="page info-page">
                <h2>üåü Tentang Mega XO</h2>
                <div class="info-text">
                    Di sini Anda dapat mengelola akun Mega XO dengan mudah dan aman. Platform ini menyediakan layanan login menggunakan akun Google untuk kemudahan akses, serta fitur pengelolaan profil yang lengkap.
                </div>
                <div class="info-text">
                    Anda memiliki kontrol penuh terhadap akun Anda. Jika suatu saat Anda ingin menghapus akun Mega XO, fitur tersebut tersedia di dashboard dengan proses yang aman dan mudah. Semua data akan dihapus secara permanen sesuai kebijakan privasi kami.
                </div>
            </div>

            <!-- Page 3: Login -->
            <div class="page login-page" id="loginPage">
                <h2>üîê Masuk ke Akun</h2>
                <div class="login-info">
                    Login dengan akun Google Anda untuk mengakses dashboard personal. Setelah login, Anda dapat melihat informasi profil, mengelola pengaturan akun, dan jika diperlukan, menghapus akun Mega XO secara permanen.
                </div>

                <div id="error" class="error"></div>
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <span>Sedang login...</span>
                </div>

                <button id="googleLoginBtn" class="google-btn">
                    <div class="google-icon">G</div>
                    Masuk dengan Google
                </button>

                <div class="login-success-message">
                    ‚úÖ Login berhasil! Anda sekarang dapat mengakses dashboard untuk mengelola akun.
                </div>
            </div>

            <!-- Page 4: Home -->
            <div class="page home-page">
                <h2>üè† Dashboard Pemain</h2>

                <div id="userInfo" class="user-info">
                    <img id="userAvatar" src="" alt="Avatar">
                    <div class="user-details">
                        <h3 id="userName"></h3>
                        <p id="userEmail"></p>
                    </div>
                </div>

                <div class="button-group">
                    <button id="deleteAccountBtn" class="btn btn-danger">
                        <span>üóëÔ∏è</span>
                        Hapus Akun
                    </button>
                    <button id="logoutBtn" class="btn btn-secondary">
                        <span>üö™</span>
                        Keluar
                    </button>
                </div>

                <div id="homeError" class="error"></div>
                <div id="homeSuccess" class="success"></div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="nav-container">
            <button class="nav-btn active" onclick="goToPage(0)">Beranda</button>
            <button class="nav-btn" onclick="goToPage(1)">Info</button>
            <button class="nav-btn" onclick="goToPage(2)">Login</button>
            <button class="nav-btn" onclick="goToPage(3)" id="homeNavBtn" style="display: none;">Dashboard</button>
        </div>
    </div>

    <!-- Modal Konfirmasi Hapus Akun -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h3>‚ö†Ô∏è Konfirmasi Hapus Akun</h3>
            <p>Apakah Anda yakin ingin menghapus akun Mega XO? Tindakan ini akan menghapus semua data profil, informasi personal, dan riwayat akun Anda secara permanen dari server kami.</p>
            <p>Setelah akun dihapus, Anda tidak akan dapat mengakses dashboard lagi dan semua informasi yang tersimpan akan hilang secara permanen. Proses penghapusan ini tidak dapat dibatalkan.</p>
            <p><strong>Tindakan ini tidak dapat dibatalkan!</strong></p>
            
            <div class="modal-buttons">
                <button id="confirmDeleteBtn" class="btn btn-danger">
                    <span>‚ö†Ô∏è</span> Ya, Hapus Akun
                </button>
                <button id="cancelDeleteBtn" class="btn btn-secondary">
                    <span>‚ùå</span> Batal
                </button>
            </div>
        </div>
    </div>

    <script>
        // Konfigurasi PocketBase
        const pb = new PocketBase('https://megaxo-dev.lightcodedigital.cloud');
        
        // Elemen DOM
        const pageContainer = document.getElementById('pageContainer');
        const loginPage = document.getElementById('loginPage');
        const googleLoginBtn = document.getElementById('googleLoginBtn');
        const deleteAccountBtn = document.getElementById('deleteAccountBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const deleteModal = document.getElementById('deleteModal');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        const homeNavBtn = document.getElementById('homeNavBtn');
        
        // Navigation state
        let currentPage = 0;
        const totalPages = 4;

        // Page navigation
        function goToPage(pageIndex) {
            if (pageIndex < 0 || pageIndex >= totalPages) return;
            
            // Update current page
            currentPage = pageIndex;
            
            // Calculate transform (each page is 25% width)
            const translateX = -pageIndex * 25;
            pageContainer.style.transform = `translateX(${translateX}%)`;
            
            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach((btn, index) => {
                btn.classList.toggle('active', index === pageIndex);
            });
            
            // Update indicators
            document.querySelectorAll('.indicator').forEach((indicator, index) => {
                indicator.classList.toggle('active', index === pageIndex);
            });
        }

        // Update login page UI based on auth state
        function updateLoginPageUI() {
            if (pb.authStore.isValid) {
                loginPage.classList.add('authenticated');
            } else {
                loginPage.classList.remove('authenticated');
            }
        }

        // Auto navigation based on auth state
        function updateNavigation() {
            if (pb.authStore.isValid) {
                homeNavBtn.style.display = 'block';
                // Auto go to dashboard if logged in and not already there
                if (currentPage < 3) {
                    goToPage(3);
                }
            } else {
                homeNavBtn.style.display = 'none';
                // Don't allow access to dashboard when not logged in
                if (currentPage === 3) {
                    goToPage(2);
                }
            }
            updateLoginPageUI();
        }

        // Fungsi untuk menampilkan pesan error
        function showError(message, isHome = false) {
            const errorEl = isHome ? document.getElementById('homeError') : document.getElementById('error');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            setTimeout(() => {
                errorEl.style.display = 'none';
            }, 6000);
        }
        
        // Fungsi untuk menampilkan pesan sukses
        function showSuccess(message, isHome = false) {
            const successEl = isHome ? document.getElementById('homeSuccess') : document.getElementById('success');
            if (successEl) {
                successEl.textContent = message;
                successEl.style.display = 'block';
                setTimeout(() => {
                    successEl.style.display = 'none';
                }, 4000);
            }
        }
        
        // Fungsi untuk menampilkan loading
        function showLoading(show = true) {
            const loadingEl = document.getElementById('loading');
            if (show) {
                loadingEl.classList.add('show');
            } else {
                loadingEl.classList.remove('show');
            }
            googleLoginBtn.disabled = show;
        }
        
        // Fungsi untuk menampilkan informasi user
        function displayUserInfo() {
            const user = pb.authStore.model;
            if (user) {
                document.getElementById('userName').textContent = user.name || user.username || 'Pengguna Platform';
                document.getElementById('userEmail').textContent = user.email;
                
                // Avatar dengan fallback yang lebih baik
                const avatarUrl = user.avatar ? 
                    `https://megaxo-dev.lightcodedigital.cloud/api/files/_pb_users_auth_/${user.id}/${user.avatar}` :
                    `https://ui-avatars.com/api/?name=${encodeURIComponent(user.name || user.username || 'User')}&background=667eea&color=fff&size=120`;
                
                document.getElementById('userAvatar').src = avatarUrl;
            }
        }
        
        // Login dengan Google
        googleLoginBtn.addEventListener('click', async () => {
            try {
                showLoading(true);
                
                // Lakukan OAuth dengan Google
                const authData = await pb.collection('users').authWithOAuth2({
                    provider: 'google',
                    createData: {
                        emailVisibility: true,
                    }
                });
                
                displayUserInfo();
                updateNavigation();
                showSuccess('üéâ Selamat datang di Platform Mega XO! Akun Anda siap digunakan.', true);
                
            } catch (error) {
                console.error('Login error:', error);
                let errorMessage = 'Gagal login dengan Google. ';
                
                if (error.message.includes('OAuth')) {
                    errorMessage += 'Pastikan konfigurasi OAuth sudah benar.';
                } else if (error.message.includes('network')) {
                    errorMessage += 'Periksa koneksi internet Anda.';
                } else {
                    errorMessage += 'Silakan coba lagi dalam beberapa saat.';
                }
                
                showError(errorMessage);
            } finally {
                showLoading(false);
            }
        });
        
        // Logout
        logoutBtn.addEventListener('click', () => {
            pb.authStore.clear();
            updateNavigation();
            showSuccess('Terima kasih telah menggunakan Platform Mega XO. Sampai jumpa!', true);
        });
        
        // Tampilkan modal konfirmasi hapus akun
        deleteAccountBtn.addEventListener('click', () => {
            deleteModal.style.display = 'block';
        });
        
        // Tutup modal
        cancelDeleteBtn.addEventListener('click', () => {
            deleteModal.style.display = 'none';
        });
        
        // Konfirmasi hapus akun
        confirmDeleteBtn.addEventListener('click', async () => {
            try {
                const userId = pb.authStore.model?.id;
                if (!userId) {
                    throw new Error('User ID tidak ditemukan');
                }
                
                // Hapus akun user
                await pb.collection('users').delete(userId);
                
                // Clear auth store
                pb.authStore.clear();
                
                // Tutup modal
                deleteModal.style.display = 'none';
                
                updateNavigation();
                showSuccess('‚úÖ Akun Platform Mega XO berhasil dihapus. Terima kasih telah mempercayai layanan kami!', true);
                
            } catch (error) {
                console.error('Delete error:', error);
                showError('‚ùå Gagal menghapus akun. Silakan coba lagi atau hubungi support.', true);
                deleteModal.style.display = 'none';
            }
        });
        
        // Tutup modal jika klik di luar modal
        deleteModal.addEventListener('click', (e) => {
            if (e.target === deleteModal) {
                deleteModal.style.display = 'none';
            }
        });
        
        // Listen untuk perubahan auth state
        pb.authStore.onChange(() => {
            updateNavigation();
            if (pb.authStore.isValid) {
                displayUserInfo();
            }
        });
        
        // Inisialisasi
        updateNavigation();
        if (pb.authStore.isValid) {
            displayUserInfo();
        }
        
        // Refresh auth token secara otomatis
        setInterval(() => {
            if (pb.authStore.isValid) {
                pb.collection('users').authRefresh().catch(() => {
                    pb.authStore.clear();
                    showError('Sesi Anda telah berakhir. Silakan login kembali.');
                });
            }
        }, 10 * 60 * 1000);

        // Error handling untuk koneksi
        window.addEventListener('online', () => {
            if (!pb.authStore.isValid) {
                showSuccess('üåê Koneksi internet pulih. Anda dapat login sekarang.');
            }
        });

        window.addEventListener('offline', () => {
            showError('üåê Koneksi internet terputus. Beberapa fitur mungkin tidak berfungsi.');
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft' && currentPage > 0) {
                goToPage(currentPage - 1);
            } else if (e.key === 'ArrowRight' && currentPage < totalPages - 1) {
                // Don't allow navigation to dashboard if not logged in
                if (currentPage === 2 && !pb.authStore.isValid) return;
                goToPage(currentPage + 1);
            }
        });

        // Touch/swipe navigation for mobile
        let touchStartX = 0;
        let touchEndX = 0;

        pageContainer.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
        });

        pageContainer.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;

            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0 && currentPage < totalPages - 1) {
                    // Swipe left - go to next page
                    if (currentPage === 2 && !pb.authStore.isValid) return;
                    goToPage(currentPage + 1);
                } else if (diff < 0 && currentPage > 0) {
                    // Swipe right - go to previous page
                    goToPage(currentPage - 1);
                }
            }
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            // Force recalculation of page position
            goToPage(currentPage);
        });
    </script>
</body>
</html>